#!/bin/bash

FILE_TO_TRACK="src/app/Resources/resources.component.ts"
JSON_FILE="git-backend/updates.json"

# Get the latest commit timestamp for the file
LAST_UPDATE=$(git log -1 --date=iso-strict --format="%cd" -- "$FILE_TO_TRACK")

# If the file has changed in this commit, update updates.json
if git diff --cached --name-only | grep -q "$FILE_TO_TRACK"; then
    jq --arg file "$FILE_TO_TRACK" --arg date "$LAST_UPDATE" \
       '.[$file] = $date' "$JSON_FILE" > temp.json && mv temp.json "$JSON_FILE"

    echo "âœ… Updated $FILE_TO_TRACK timestamp in $JSON_FILE"
    git add "$JSON_FILE"  # Stage the updates.json file for commit
fi

# Fetch from the accessibility-training repository (local or remote)
git fetch accessibility-training


# Navigate to git-backend and commit/push updates.json
(
  # Get the last commit message from the 'accessibility-training' main branch
  cd git-backend || exit 1  # Change path if necessary
  git add updates.json
    # Get the last commit message from the 'accessibility-training' main branch
    COMMIT_MESSAGE=$(git log accessibility-training/master -1 --pretty=format:"%s")
  git commit -m "Auto-update: - ${COMMIT_MESSAGE} - Changed updates.json"
  git push origin main
) &>/dev/null